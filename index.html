<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rocket Budget App</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f4f8fb;
      margin: 0;
      color: #333;
    }

    header {
      background: #0d47a1;
      color: white;
      text-align: center;
      padding: 20px;
      font-size: 1.8em;
    }

    .container {
      max-width: 480px;
      margin: auto;
      padding: 20px;
    }

    .balance-summary {
      background: #e3f2fd;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    .balance-summary h2 {
      margin: 0;
      font-size: 1.4em;
    }

    input, select, button {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border: 1px solid #ccc;
      border-radius: 10px;
      font-size: 1em;
    }

    button {
      background: #0d47a1;
      color: white;
      border: none;
    }

    button:hover {
      background: #0b3c91;
    }

    .transactions {
      margin-top: 20px;
      max-height: 200px;
      overflow-y: auto;
      background: white;
      border-radius: 10px;
      padding: 10px;
    }

    .transaction {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }

    .income { color: green; }
    .expense { color: red; }

    .goal-section {
      background: #e3f2fd;
      padding: 10px;
      border-radius: 10px;
      margin-top: 20px;
    }

    canvas { margin-top: 20px; }

    .filter-section, .tip-section {
      margin-top: 20px;
      background: #fff;
      padding: 10px;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <header>ðŸš€ Rocket Budget App</header>
  <div class="container">
    <div class="balance-summary">
      <h2 id="balance">Balance: $0.00</h2>
      <p id="monthlyIncome">Monthly Income: $0.00</p>
      <p id="monthlyExpenses">Monthly Expenses: $0.00</p>
    </div>

    <input type="number" id="amount" placeholder="Amount" />
    <input type="text" id="category" placeholder="Category (e.g. Groceries)" />
    <select id="type">
      <option value="income">Income</option>
      <option value="expense">Expense</option>
    </select>
    <label><input type="checkbox" id="recurring" /> Recurring Monthly</label>
    <button onclick="addTransaction()">Add Transaction</button>

    <div class="goal-section">
      <input type="number" id="goal" placeholder="Set Saving Goal ($)" />
      <button onclick="setGoal()">Set Goal</button>
      <p id="goalStatus"></p>
    </div>

    <div class="filter-section">
      <label for="monthFilter">Filter by Month:</label>
      <select id="monthFilter" onchange="updateUI()">
        <option value="all">All</option>
      </select>
    </div>

    <div class="transactions" id="transactionList"></div>

    <canvas id="ratioChart"></canvas>
    <canvas id="trendChart"></canvas>

    <div class="tip-section">
      <h4>ðŸ’¡ Savings Tip</h4>
      <p id="aiTip"></p>
    </div>
  </div>

  <script>
    let balance = 0;
    let incomeTotal = 0;
    let expenseTotal = 0;
    let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
    let goal = parseFloat(localStorage.getItem('goal')) || 0;

    const balanceEl = document.getElementById("balance");
    const incomeEl = document.getElementById("monthlyIncome");
    const expenseEl = document.getElementById("monthlyExpenses");
    const listEl = document.getElementById("transactionList");
    const goalStatusEl = document.getElementById("goalStatus");
    const ratioChartEl = document.getElementById("ratioChart").getContext("2d");
    const trendChartEl = document.getElementById("trendChart").getContext("2d");
    const tipEl = document.getElementById("aiTip");
    const monthFilterEl = document.getElementById("monthFilter");
    let ratioChart;
    let trendChart;

    function addTransaction() {
      const amount = parseFloat(document.getElementById("amount").value);
      const category = document.getElementById("category").value || "General";
      const type = document.getElementById("type").value;
      const recurring = document.getElementById("recurring").checked;

      if (isNaN(amount) || amount <= 0) {
        alert("Enter a valid amount.");
        return;
      }

      const date = new Date();
      const transaction = { amount, category, type, date: date.toISOString(), recurring };
      transactions.unshift(transaction);
      localStorage.setItem('transactions', JSON.stringify(transactions));

      updateTotals();
      updateUI();
    }

    function setGoal() {
      const goalAmount = parseFloat(document.getElementById("goal").value);
      if (!isNaN(goalAmount) && goalAmount > 0) {
        goal = goalAmount;
        localStorage.setItem('goal', goal);
        goalStatusEl.textContent = `Goal set to $${goal}`;
      } else {
        alert("Enter a valid goal amount.");
      }
    }

    function updateTotals() {
      balance = 0;
      incomeTotal = 0;
      expenseTotal = 0;
      const filter = monthFilterEl.value;

      transactions.forEach(t => {
        const d = new Date(t.date);
        const tag = `${d.getFullYear()}-${d.getMonth()}`;
        if (filter !== "all" && tag !== filter) return;

        if (t.type === "income") {
          incomeTotal += t.amount;
          balance += t.amount;
        } else {
          expenseTotal += t.amount;
          balance -= t.amount;
        }
      });
    }

    function updateUI() {
      updateMonthFilter();
      updateTotals();

      balanceEl.textContent = `Balance: $${balance.toFixed(2)}`;
      incomeEl.textContent = `Monthly Income: $${incomeTotal.toFixed(2)}`;
      expenseEl.textContent = `Monthly Expenses: $${expenseTotal.toFixed(2)}`;

      const filter = monthFilterEl.value;
      listEl.innerHTML = "";
      transactions.forEach(t => {
        const d = new Date(t.date);
        const tag = `${d.getFullYear()}-${d.getMonth()}`;
        if (filter !== "all" && tag !== filter) return;

        const row = document.createElement("div");
        row.className = "transaction";
        const date = d.toLocaleDateString();
        const label = t.recurring ? '(Recurring)' : '';
        row.innerHTML = `<span>${date} - ${t.category} ${label}</span><span class="${t.type}">${t.type === 'income' ? '+' : '-'}$${t.amount.toFixed(2)}</span>`;
        listEl.appendChild(row);
      });

      if (goal > 0) {
        const remaining = goal - balance;
        goalStatusEl.textContent = remaining > 0 ? `You are $${remaining.toFixed(2)} away from your goal.` : `Goal reached! ðŸŽ‰`;
      }

      renderChart();
      renderTrend();
      generateTip();
    }

    function updateMonthFilter() {
      const uniqueMonths = new Set(transactions.map(t => {
        const d = new Date(t.date);
        return `${d.getFullYear()}-${d.getMonth()}`;
      }));

      monthFilterEl.innerHTML = '<option value="all">All</option>';
      [...uniqueMonths].sort().forEach(m => {
        const [year, month] = m.split('-');
        const date = new Date(year, month);
        const label = date.toLocaleString('default', { month: 'short', year: 'numeric' });
        const option = document.createElement('option');
        option.value = m;
        option.textContent = label;
        monthFilterEl.appendChild(option);
      });
    }

    function renderChart() {
      if (ratioChart) ratioChart.destroy();
      ratioChart = new Chart(ratioChartEl, {
        type: 'doughnut',
        data: {
          labels: ['Income', 'Expenses'],
          datasets: [{
            data: [incomeTotal, expenseTotal],
            backgroundColor: ['#42a5f5', '#ef5350']
          }]
        },
        options: {
          plugins: {
            legend: { position: 'bottom' }
          }
        }
      });
    }

    function renderTrend() {
      const grouped = {};
      transactions.forEach(t => {
        const d = new Date(t.date);
        const tag = `${d.getFullYear()}-${d.getMonth()}`;
        if (!grouped[tag]) grouped[tag] = { income: 0, expense: 0 };
        grouped[tag][t.type] += t.amount;
      });
      const labels = Object.keys(grouped).sort();
      const incomeData = labels.map(m => grouped[m].income);
      const expenseData = labels.map(m => grouped[m].expense);

      if (trendChart) trendChart.destroy();
      trendChart = new Chart(trendChartEl, {
        type: 'line',
        data: {
          labels: labels.map(l => new Date(l.split('-')[0], l.split('-')[1]).toLocaleString('default', { month: 'short', year: 'numeric' })),
          datasets: [
            { label: 'Income', data: incomeData, borderColor: '#42a5f5', fill: false },
            { label: 'Expenses', data: expenseData, borderColor: '#ef5350', fill: false }
          ]
        },
        options: {
          responsive: true,
          plugins: { legend: { position: 'bottom' } }
        }
      });
    }

    function generateTip() {
      if (expenseTotal > incomeTotal * 0.9) {
        tipEl.textContent = "You're spending close to what you earn. Try cutting discretionary expenses like dining out.";
      } else if (incomeTotal > 0 && expenseTotal / incomeTotal < 0.5) {
        tipEl.textContent = "Great job saving! Consider automating a portion of your income to savings.";
      } else {
        tipEl.textContent = "Review your subscriptions and eliminate any unused services to boost savings.";
      }
    }

    // Initialize
    updateUI();
  </script>
</body>
</html>